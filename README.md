# まりもっち（marimo-care）

癒やし系・放置育成アプリ「まりもっち」。スマホの中でマリモをゆっくり育て、水換えや背景カスタム、スクショ共有を楽しめます。

**対応プラットフォーム**: iOS / Android（Flutter）

## 概要
- 日ごとの“少しずつの成長”と、週1回程度の水換えで手軽に愛着が湧く体験を提供します。
- センサー連動で本体を傾けるとマリモが転がり、日中は“光合成”としてゆっくり漂います（設定でON/OFF）。
- 背景はプリセットに加え、端末のアルバム画像も使用可能。水槽アイテム（SVG）を配置して自分だけの水槽に。

## 主な機能
- マリモ育成とステータス表示（サイズmm、清潔度、開始日、最終水換え）
- 水換え（24時間クールダウン、波紋エフェクト＋効果音、ボーナス成長）
- 成長ログ（日次でサイズと清潔度を記録し、未起動日もまとめて反映）
- ローカル通知（最終水換えから一定日数経過で毎朝10:00にリマインド）
- センサー連動の物理挙動（傾きで転がる、日中はゆるい浮遊）
- 背景カスタム（プリセット12種＋アルバム画像）
- 水槽アイテム（SVG）追加・配置・回転・拡縮、前面/背面の切り替え
- スクリーンショット保存・共有（透かしロゴON/OFF）

## 動作要件
- Flutter（Stable）3.24 以降推奨（Dart 3.5系）
- iOS 15+ / Android 8.0+ 目安

## セットアップ
1) 依存関係取得
```
flutter pub get
```

2) 実行
```
# Android
flutter run -d android

# iOS（初回は Xcode での署名設定が必要な場合あり）
flutter run -d ios
```

3) ビルド（任意）
```
flutter build apk    # Android
flutter build ios    # iOS
```

## 使い方（基本フロー）
- 初回起動で「名前」と「背景」を選択して開始
- ホーム画面でマリモを眺める／つつく（タップ）／転がす（端末を傾ける）
- 「水換え」ボタンで清潔度リセット＋同日ボーナス成長（24時間クールダウン）
- 「アイテム追加」で水槽用SVGを配置（ピンチで拡縮・回転、長押しで削除/前後入替）
- 右上の設定から通知ON/OFF、スクショ透かし、光合成アニメ、背景変更を調整
- 共有メニューからスクショ保存・SNS共有（LINE/X等）

## 成長と通知の仕様（現行実装）
- 日次成長
  - 1日あたりの基本増分は正規分布（平均0.15mm、σ=0.05、0〜0.3にクランプ）
  - 清潔度の影響で係数k（0.5〜1.0）が変動し、同日水換えで+0.1mmのボーナス
  - 水換え後3日間はkに+0.1（上限1.2）
  - 清潔度は毎日10ずつ減少（最小0）
  - アプリ未起動日も経過日分をまとめて反映
- 水換え
  - 実施すると清潔度=100、最終水換え時刻更新、当日+0.1mm成長、以後3日間成長係数にブースト
  - 連続実行の防止として24時間クールダウン
- 死亡判定
  - 最終水換え（なければ開始日）から11日経過でMarimoState=dead（成長停止）
- 通知スケジュール（10:00 ローカル）
  - 最終水換えから4日経過後の10:00以降に初回通知
  - 以後、実施まで毎日10:00に1回通知（10日目は警告、11日目は“いなくなった”通知）

参考：実装は `lib/growth_logic.dart` と `lib/notification_service.dart` を参照

## ディレクトリ構成（抜粋）
- `lib/main.dart`: ルーティング/起動処理
- `lib/pages/setup_page.dart`: 初期セットアップ（名前/背景）
- `lib/pages/home_page.dart`: ホーム（表示・物理挙動・水換え・共有・アイテム配置）
- `lib/pages/settings_page.dart`: 設定（通知、透かし、ハプティクス、光合成、背景）
- `lib/models.dart`: データモデル（Marimo, GrowthLog, UserSetting, TankItem）
- `lib/storage.dart`: `shared_preferences` ラッパー
- `lib/growth_logic.dart`: 成長エンジン
- `lib/notification_service.dart`: ローカル通知（タイムゾーン対応）
- `lib/tank_items.dart`: 水槽アイテム（SVG）レジストリ
- `lib/backgrounds.dart`: プリセット背景
- `assets/`: 画像・SVG・効果音

## 権限とプラットフォーム設定
- iOS
  - すでに `Info.plist` に写真ライブラリ用の説明文（保存用途）が含まれています。
  - 通知は初回に権限を要求します。
- Android
  - 通知権限（Android 13+）はプラグイン側のAPIで要求します。
  - 端末やOSバージョンにより外部ストレージ権限が必要な場合があります。

## よくある操作
- スクショ保存が失敗する場合
  - 写真ライブラリ権限が拒否されていないか確認してください。
- 通知が来ない場合
  - 設定で通知がONか確認、OSの通知権限も許可してください。
  - 最終水換えから4日未満の間は通知が来ません。

## ライセンス/著作権
本リポジトリ内の画像/音源/アイコン等のアセットは、プロジェクト専用素材を含みます。再利用についてはプロジェクトオーナーに確認してください。
