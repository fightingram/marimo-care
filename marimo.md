# マリモ育成アプリ（Flutter）簡易仕様書 v0.2（更新）

> 一番小さい手数で“癒やし”が得られる育成体験。放置でも進むが、ちょっと触ると嬉しい。

---

## 1. 概要

- **アプリ名（仮）**: まりもっち / Marimochi（要検討）
- **目的**: 最小操作で癒やし・成長感を提供。忙しい人でも“続く”ペット体験。
- **コア体験**: 名前をつけたマリモが日ごとに少しずつ大きくなる。週1回の水換えで成長ボーナス。
- **対象**: 10〜40代、放置系/観賞系が好き、忙しい社会人・学生。

---

## 2. 主要価値

- **放置でOK**: 不在時も微増。戻ると変化が見える。
- **シンプル操作**: 水換え／転がす／背景変更のみでも満足度。
- **リアル感**: 成長は1日単位更新。履歴で“昨日より”を実感。

---

## 3. 機能一覧（MVP）

| 機能         | 仕様・キーワード                                                | 備考              |
| ---------- | ------------------------------------------------------- | --------------- |
| 初回セットアップ   | 名前入力、簡単チュートリアル、初期背景選択                                   | ローカル保存（端末内）     |
| 水換え        | **週1回推奨**。実行で成長係数+α、清潔度リセット                             | 連打防止（クールダウン24h） |
| 背景変更       | 11種プリセット（春/夏/秋/冬/和紙/宇宙/深海/木漏れ日/夜景/苔庭/雪） + 端末アルバム画像      | 画像トリミング・ぼかし（任意） |
| 物理インタラクション | ジャイロで転がる／ドラッグ移動／ダブルタップで“つつく”／2本指で回転                     | 端末ハプティクス、軽い水面波紋 |
| 光合成・浮遊     | 昼間（端末時刻）にランダム浮遊アニメ                                      | 設定でON/OFF       |
| SNSシェア     | 水槽のスクショ作成 → X/Facebook/Instagramへ共有                     | 透かしロゴ（ON/OFF）   |
| 成長データ      | 「育て始めた日」「最後の水換え」「サイズ」「清潔度」                              | 1日1回ログ化         |
| ローカル通知     | **最後の水換えから4日経過した日の10:00**に通知。以後、水換え実施まで**毎日10:00に1回**通知 | 任意で通知OFF可       |
| バックアップ     | **当面なし**（端末移行対応なし）。将来のv1.2以降で検討                         |                 |

---

## 4. 成長ロジック（案）

- **時刻**: 毎日0:00（端末ローカル）に“成長Tick”を1回処理。
- **基本サイズ**: `size_mm`（直径mm換算の見た目値）。
- **基本増分**: `Δbase = clamp( Normal(μ=0.15mm, σ=0.05), 0, 0.3 )`/日。※数値は仮置き
- **清潔度**: `cleanliness` ∈ [0,100]。水換え時=100、毎日 `-d`（例: 8）。
- **成長係数**: `k = 0.5 + 0.5*(cleanliness/100)`（汚れで0.5〜綺麗で1.0）。
- **水換えボーナス**: 当日成長に `+bonus`（例: +0.1mm）& 3日間 `k` に+0.1（上限1.2）。
- **過保護抑制**: 水換えクールダウン24h（多重ボーナス無効）。
- **未ログ日補完**: アプリ未起動日も経過日分をまとめて反映（※死亡判定以降は停止）。
- **最後の操作時刻**: `lastInteractionAt` を更新（ドラッグ/水換え/背景変更/つつく等）。
- **死亡判定（新規）**: `now - max(lastWaterChangeAt, lastInteractionAt) ≥ 10日` で **状態=Dead**。
  - Dead中は成長停止、清潔度固定。
  - 初回起動時に死亡状態であれば専用UIを表示（下記フロー参照）。
- **見た目**: サイズ増分は短いスケールアニメで演出。

> 数値は暫定。チューニングは将来 `app_config.json` 等で調整。

---

## 5. 画面＆フロー（MVP）

1. **スプラッシュ → 初回セットアップ**（名前付け、背景選択）
2. **ホーム（水槽）**
   - 中央にマリモ。タップ/ドラッグ/傾き反応
   - 下部：水換えボタン、背景変更、スクショ共有
   - 上部：サイズmm、清潔度バー、最終水換え日時
3. **背景ギャラリー**（11種＋アルバム導線）
4. **まりもデータ**（成長履歴、開始日、合計水換え回数）
5. **設定**（通知、効果音/振動、スクショ透かしON/OFF）
6. **死亡時UI（新規）**
   - 10日無操作・無水換えで死亡判定時、ホーム遷移時にモーダル/専用スクリーン表示
   - 文言例：「まりもが死んでしまいました。水槽をリセットして、また育ててあげてください。」
   - ボタン：**新しいまりもでリスタート**（データ初期化） / **記録を見る**（最終状態のデータ参照）

---

## 6. 非機能要件

- **対応OS**: iOS 15+ / Android 8.0+
- **パフォーマンス**: 60fps目標、アイドル時は描画間引きで省電力
- **起動時間**: コールドスタート < 2.5秒
- **データ**: 端末ローカル保存（`shared_preferences` or `sqflite`）
- **アクセシビリティ**: 文字サイズOS設定反映、操作はタップで代替可

---

## 7. 技術スタック（案）

- **Flutter**（Stable） / **Dart**
- 物理・センサー: `sensors_plus`, `flutter_haptic_feedback`（候補）
- 画像: `image_picker`, `image`（トリミング/ぼかしは将来）
- アニメ/描画: **2Dスプライト/CustomPainterで固定（MVP）**。Rive/Flameは将来検討。
- ストレージ: `shared_preferences`（簡易）, 必要に応じ `sqflite` へ移行
- 通知: `flutter_local_notifications`
- シェア: `share_plus`
- 分析（任意）: `firebase_analytics`（将来）

---

## 8. データモデル（MVP）

```text
Marimo {
  id: String
  name: String
  state: 'alive' | 'dead'
  sizeMm: double
  cleanliness: int   // 0..100
  startedAt: DateTime
  lastWaterChangeAt: DateTime
  lastGrowthTickAt: DateTime
  lastInteractionAt: DateTime
}

GrowthLog {
  date: YYYY-MM-DD
  deltaMm: double
  sizeAfterMm: double
  cleanlinessAfter: int
}

UserSetting {
  notificationsEnabled: bool
  screenshotWatermark: bool
  haptics: bool
}
```

---

## 9. 端末機能・権限

- **写真ライブラリ**（背景にアルバム画像を使うとき）
- **通知**（リマインド）
- **センサー**（加速度/ジャイロ）

---

## 10. マネタイズ（将来）

- **広告**: ホーム常時は×。スクショ保存後/背景変更画面の控えめインタースティシャル（頻度制限）
- **課金**: 買い切り（広告除去）

---

## 11. 分析KPI（軽量）

- DAU/7日継続率、平均起動間隔、水換え頻度、死亡発生率、スクショ共有回数

---

## 12. ロードマップ

- **MVP**: 基本育成＋水換え＋背景変更＋物理インタラクション＋シェア＋通知＋死亡イベント
- **v1.1**: 季節テーマ、波紋エフェクト、履歴グラフ

---

## 13. 受け入れ基準（例）

- 最後の水換えから4日経過でAM10時に通知が来る
- 最後の操作から10日経過で死亡画面に切り替わる
- 水換えボタンは24時間以内に再押下しても無効
- アプリ未起動でも経過日分の成長が反映される

